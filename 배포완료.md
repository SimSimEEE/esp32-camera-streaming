/**
 * `ë°°í¬ì™„ë£Œ.md`
 * - ESP32 Camera Streaming ë°°í¬ ì™„ë£Œ ìƒíƒœ
 *
 * @author      Sim Si-Geun <simsimee@lemoncloud.io>
 * @date        2026-02-18 ë°°í¬ ì™„ë£Œ
 *
 * @copyright   (C) 2026 LemonCloud Co Ltd. - All Rights Reserved.
 */

# ğŸ‰ ë°°í¬ ì™„ë£Œ!

## âœ… ì™„ë£Œëœ ë°°í¬

### 1. ì›¹ í´ë¼ì´ì–¸íŠ¸ â†’ S3 âœ…

```
S3 ë²„í‚·: esp32-camera-viewer
ì—…ë¡œë“œëœ íŒŒì¼:
  âœ“ index.html
  âœ“ app.js
  âœ“ config.js
  âœ“ styles.css
  âœ“ nginx.conf

ì›¹ì‚¬ì´íŠ¸ URL: http://esp32-camera-viewer.s3-website-ap-northeast-2.amazonaws.com
```

### 2. Java ì„œë²„ â†’ ECR âœ…

```
ECR ì´ë¯¸ì§€: 540298831859.dkr.ecr.ap-northeast-2.amazonaws.com/esp32-camera-server:latest
Digest: sha256:faaebe5f58be9a799e1f0f21ae7d859ea2df045784dbeb3542536620e6658087
ìƒíƒœ: âœ… í‘¸ì‹œ ì™„ë£Œ
```

### 3. ESP32 íŒì›¨ì–´ ë¹Œë“œ âœ…

```
íŒì›¨ì–´ íŒŒì¼: esp32-camera-firmware/.pio/build/esp32cam/firmware.bin
í¬ê¸°: 935KB
ìƒíƒœ: âœ… ë¹Œë“œ ì™„ë£Œ (ì—…ë¡œë“œ ëŒ€ê¸°)
```

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

### 1ï¸âƒ£ AWS App Runner ë°°í¬ (í•„ìˆ˜)

ECR ì´ë¯¸ì§€ë¥¼ App Runnerì— ë°°í¬í•´ì•¼ í•©ë‹ˆë‹¤:

**ë°©ë²• A: AWS Console ì‚¬ìš©**

1. **AWS Console â†’ App Runner** ì ‘ì†
2. **Create service** í´ë¦­
3. ì„¤ì •:
   - **Source**: Container registry â†’ Amazon ECR
   - **Image URI**: `540298831859.dkr.ecr.ap-northeast-2.amazonaws.com/esp32-camera-server:latest`
   - **Port**: `8887`
   - **CPU/Memory**: 1 vCPU, 2 GB (ê¶Œì¥)
4. **Create & deploy** í´ë¦­
5. ë°°í¬ ì™„ë£Œ í›„ **ì„œë¹„ìŠ¤ URL í™•ì¸**
   - ì˜ˆ: `https://xxx.ap-northeast-2.awsapprunner.com`

**ë°©ë²• B: AWS CLI ì‚¬ìš©**

```bash
# App Runner ì„œë¹„ìŠ¤ ìƒì„± (ì²˜ìŒ ë°°í¬ ì‹œ)
aws apprunner create-service \
  --service-name esp32-camera-server \
  --source-configuration '{
    "ImageRepository": {
      "ImageIdentifier": "540298831859.dkr.ecr.ap-northeast-2.amazonaws.com/esp32-camera-server:latest",
      "ImageConfiguration": {
        "Port": "8887"
      },
      "ImageRepositoryType": "ECR"
    },
    "AutoDeploymentsEnabled": true
  }' \
  --instance-configuration '{
    "Cpu": "1024",
    "Memory": "2048"
  }'
```

### 2ï¸âƒ£ ì›¹ í´ë¼ì´ì–¸íŠ¸ ì„¤ì • ì—…ë°ì´íŠ¸

App Runner URLì„ ë°›ì€ í›„, config.jsë¥¼ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”:

**íŒŒì¼**: [esp32-camera-client/config.js](esp32-camera-client/config.js)

```javascript
// production ì„¹ì…˜ ìˆ˜ì •
production: {
    wsUrl: 'wss://xxx.ap-northeast-2.awsapprunner.com/viewer',  // â† App Runner URLë¡œ ë³€ê²½
    reconnectInterval: 3000,
    heartbeatInterval: 30000
}
```

**ì¬ë°°í¬**:
```bash
cd esp32-camera-client
npm run deploy
```

### 3ï¸âƒ£ ESP32 íŒì›¨ì–´ ì„¤ì • ë° ì—…ë¡œë“œ

**ì„¤ì • íŒŒì¼ ìˆ˜ì •**: [esp32-camera-firmware/ESP32_Camera_Stream/Config.h](esp32-camera-firmware/ESP32_Camera_Stream/Config.h)

```cpp
// WiFi ì„¤ì •
#define WIFI_SSID "YOUR_WIFI_SSID"           // â† ì‹¤ì œ WiFi SSID
#define WIFI_PASSWORD "YOUR_WIFI_PASSWORD"   // â† ì‹¤ì œ WiFi ë¹„ë°€ë²ˆí˜¸

// WebSocket ì„œë²„ (App Runner URL)
#define WS_HOST "xxx.ap-northeast-2.awsapprunner.com"  // â† App Runner í˜¸ìŠ¤íŠ¸
#define WS_PORT 443  // HTTPSì´ë¯€ë¡œ 443 ì‚¬ìš©
```

**ì—…ë¡œë“œ**:
```bash
cd esp32-camera-firmware
pio run --target upload

# ì‹œë¦¬ì–¼ ëª¨ë‹ˆí„°ë¡œ í™•ì¸
pio device monitor
```

---

## ğŸ” ë°°í¬ ê²€ì¦

### 1. ì„œë²„ ìƒíƒœ í™•ì¸

```bash
# ECR ì´ë¯¸ì§€ í™•ì¸
aws ecr describe-images \
  --repository-name esp32-camera-server \
  --region ap-northeast-2

# App Runner ì„œë¹„ìŠ¤ í™•ì¸ (ìƒì„± í›„)
aws apprunner list-services --region ap-northeast-2
```

### 2. ì›¹ í´ë¼ì´ì–¸íŠ¸ ì ‘ì†

**S3 ì›¹ì‚¬ì´íŠ¸ URL**:
```
http://esp32-camera-viewer.s3-website-ap-northeast-2.amazonaws.com
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] í˜ì´ì§€ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë¨
- [ ] ë²„ì „ ì •ë³´ í‘œì‹œ (í•˜ë‹¨)
- [ ] WebSocket ì—°ê²° ëŒ€ê¸° ì¤‘ (ì„œë²„ ë°°í¬ ì „ì´ë¯€ë¡œ ì •ìƒ)

### 3. ESP32 ì—°ê²° í™•ì¸ (App Runner ë°°í¬ í›„)

**ì‹œë¦¬ì–¼ ëª¨ë‹ˆí„°ì—ì„œ í™•ì¸**:
```
WiFi connected
IP address: 192.168.x.x
Connecting to WebSocket: wss://xxx.awsapprunner.com:443/esp32
WebSocket connected!
Camera initialized
Version sent: 1.0.0
```

---

## ğŸ“Š ë°°í¬ ìƒíƒœ ìš”ì•½

| ì»´í¬ë„ŒíŠ¸ | ìƒíƒœ | ìœ„ì¹˜ | ë‹¤ìŒ ë‹¨ê³„ |
|---------|------|------|----------|
| ì›¹ í´ë¼ì´ì–¸íŠ¸ | âœ… ì™„ë£Œ | S3: esp32-camera-viewer | config.js ì—…ë°ì´íŠ¸ í•„ìš” |
| Java ì„œë²„ | âœ… ECR í‘¸ì‹œ ì™„ë£Œ | ECR: esp32-camera-server:latest | App Runner ë°°í¬ í•„ìš” |
| ESP32 íŒì›¨ì–´ | âœ… ë¹Œë“œ ì™„ë£Œ | ë¡œì»¬: firmware.bin | Config.h ìˆ˜ì • í›„ ì—…ë¡œë“œ |

---

## ğŸš€ ë¹ ë¥¸ ì™„ë£Œ ê°€ì´ë“œ

### Step 1: App Runner ë°°í¬ (5ë¶„)
â†’ AWS Consoleì—ì„œ App Runner ì„œë¹„ìŠ¤ ìƒì„±

### Step 2: config.js ì—…ë°ì´íŠ¸ (1ë¶„)
â†’ App Runner URLì„ production.wsUrlì— ì„¤ì • í›„ S3 ì¬ë°°í¬

### Step 3: ESP32 ì„¤ì • ë° ì—…ë¡œë“œ (5ë¶„)
â†’ Config.hì˜ WiFi ë° ì„œë²„ URL ì„¤ì • í›„ ì—…ë¡œë“œ

---

## ğŸ¨ ìµœì¢… ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ESP32-CAM  â”‚ â”€â”€â”€â”€â”€â”€ wss://443 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  App Runner      â”‚
â”‚             â”‚        (WebSocket)                  â”‚  Port: 8887      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚  (Java Server)   â”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            â”‚
                                                            â”‚
                                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚ <â”€â”€â”€â”€â”€â”€ https:// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  S3 Website      â”‚
â”‚             â”‚        (Static Files)               â”‚  (Web Client)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ì¤‘ìš” ì •ë³´

### ECR ì´ë¯¸ì§€
```
540298831859.dkr.ecr.ap-northeast-2.amazonaws.com/esp32-camera-server:latest
```

### S3 ë²„í‚·
```
esp32-camera-viewer
http://esp32-camera-viewer.s3-website-ap-northeast-2.amazonaws.com
```

### ë²„ì „
```
Client:   v1.0.0
Server:   v1.0.0
Firmware: v1.0.0
```

---

## ğŸ¯ ì§€ê¸ˆ í•´ì•¼ í•  ì¼

**ìš°ì„ ìˆœìœ„ 1**: App Runner ë°°í¬
- AWS Console â†’ App Runner â†’ Create service
- ECR ì´ë¯¸ì§€ URI ì…ë ¥
- í¬íŠ¸ 8887 ì„¤ì •

**ìš°ì„ ìˆœìœ„ 2**: config.js ì—…ë°ì´íŠ¸
- App Runner URL í™•ì¸
- config.js production.wsUrl ìˆ˜ì •
- S3 ì¬ë°°í¬

**ìš°ì„ ìˆœìœ„ 3**: ESP32 ì—…ë¡œë“œ (ì„ íƒ)
- Config.h WiFi ì„¤ì •
- WebSocket ì„œë²„ URL ì„¤ì •
- íŒì›¨ì–´ ì—…ë¡œë“œ

---

**ë°°í¬ê°€ ê±°ì˜ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! App Runnerë§Œ ë°°í¬í•˜ë©´ ëì…ë‹ˆë‹¤.** ğŸ‰
